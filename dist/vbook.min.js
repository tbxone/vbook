function initVbooks(t,e={}){const s=document.querySelectorAll(t),i=[];return s.forEach(t=>{t.vbook||(t.vbook=new Vbook(t,e)),i.push(t.vbook)}),1===i.length?i[0]:i}!function(t,e){"object"==typeof module&&"object"==typeof module.exports?module.exports=e():"function"==typeof define&&define.amd?define([],e):t.Vbook=e()}("undefined"!=typeof window?window:this,function(){function t(t,e="",s=100){return t?`<img src="${t}" class="${e}" loading="lazy" width="${s}%" alt="book image" />`:""}class e{constructor(t,e={}){this.el=t,this.events={},this.touchData={},this.active=!1,this.moved=!1,this.threshold=e.threshold||5,this._touchMove=t=>this.move(t.touches,!0,t),this._touchEnd=()=>this._endHandler(!0),this._mouseMove=t=>this.move([{clientX:t.clientX,clientY:t.clientY}],!1),this._mouseUp=()=>this._endHandler(!1),this.init()}on(t,e){this.events[t]||(this.events[t]=[]),this.events[t].push(e)}off(t,e){this.events[t]&&(this.events[t]=this.events[t].filter(t=>t!==e))}emit(t,e){this.events[t]&&this.events[t].forEach(t=>t(e))}init(){this._boundTouchStart=t=>{this.start(t.touches,!0),document.addEventListener("touchmove",this._touchMove,{passive:!1}),document.addEventListener("touchend",this._touchEnd)},this._boundMouseStart=t=>{this.active=!0,this.start([{clientX:t.clientX,clientY:t.clientY}],!1),document.addEventListener("mousemove",this._mouseMove),document.addEventListener("mouseup",this._mouseUp)},this.el.addEventListener("touchstart",this._boundTouchStart,{passive:!1}),this.el.addEventListener("mousedown",this._boundMouseStart)}start(t,e=!0){const s=Date.now(),i=Array.from(t);this.touchData={startX:i[0].clientX,startY:i[0].clientY,startTime:s,fingers:i.length,fingerData:i.map(t=>({x:t.clientX,y:t.clientY}))},this.moved=!1,this.emit("touchdown",{x:this.touchData.startX,y:this.touchData.startY,fingers:this.touchData.fingers,fingerData:this.touchData.fingerData,inputType:e?"touch":"mouse"})}move(t,e=!0,s){s&&s.preventDefault();const i=Array.from(t),o=i[0].clientX-this.touchData.startX,a=i[0].clientY-this.touchData.startY,h=Math.sqrt(o*o+a*a);this.touchData.lastX=i[0].clientX,this.touchData.lastY=i[0].clientY,h>=this.threshold&&(this.moved||(this.moved=!0,this.emit("movestart",{x:i[0].clientX,y:i[0].clientY,dx:o,dy:a,direction:this.getDirection(o,a),distance:h,fingers:i.length,fingerData:i.map(t=>({x:t.clientX,y:t.clientY})),inputType:e?"touch":"mouse"})),this.emit("touchmove",{x:i[0].clientX,y:i[0].clientY,dx:o,dy:a,direction:this.getDirection(o,a),distance:h,fingers:i.length,fingerData:i.map(t=>({x:t.clientX,y:t.clientY})),inputType:e?"touch":"mouse"}))}_endHandler(t){this.end(t),t?(document.removeEventListener("touchmove",this._touchMove),document.removeEventListener("touchend",this._touchEnd)):(document.removeEventListener("mousemove",this._mouseMove),document.removeEventListener("mouseup",this._mouseUp))}end(t=!0){const e=Date.now()-this.touchData.startTime,s=(this.touchData.lastX||this.touchData.startX)-this.touchData.startX,i=(this.touchData.lastY||this.touchData.startY)-this.touchData.startY,o=Math.sqrt(s*s+i*i),a=this.getDirection(s,i),h={x:this.touchData.lastX||this.touchData.startX,y:this.touchData.lastY||this.touchData.startY,dx:s,dy:i,direction:a,distance:o,duration:e,fingers:this.touchData.fingers,fingerData:this.touchData.fingerData,inputType:t?"touch":"mouse"};!this.moved&&o<this.threshold?this.emit("tap",h):(this.emit("touchup",h),this.emit("swipe",h),this.emit("moveend",h),"left"===a&&this.emit("swipeLeft",h),"right"===a&&this.emit("swipeRight",h),"up"===a&&this.emit("swipeUp",h),"down"===a&&this.emit("swipeDown",h))}getDirection(t,e){return Math.abs(t)>Math.abs(e)?t>0?"right":"left":e>0?"down":"up"}destroy(){document.removeEventListener("touchmove",this._touchMove),document.removeEventListener("touchend",this._touchEnd),document.removeEventListener("mousemove",this._mouseMove),document.removeEventListener("mouseup",this._mouseUp),this.el&&(this.el.removeEventListener("touchstart",this._boundTouchStart,{passive:!1}),this.el.removeEventListener("mousedown",this._boundMouseStart)),this.events={},this.touchData={},this.active=!1,this.moved=!1,this.el=null}}return class{constructor(t,e={}){this.book="string"==typeof t?document.querySelector(t):t,this.vb_body="",this._events={},this._handlers={},this.disabled=!1,this.autoPlay=null,this.closing=!1,this.timer=!1,this.rotateTimer=!1;const s=this._parseDataset(this.book.dataset);this.options=Object.assign({},{width:210,height:300,spine:40,coverThikness:2,coverColor:"#666",spineThikness:2,spineColor:"#666",pagesOffset:2,pages:20,pagesColor:"#fff",book_img_cover:{},book_img_back:{},book_img_spine:{},book_img_pages_top:"book/head_r2.png",book_img_pages_side:"book/head_r2.png",book_img_pages_bottom:"book/head_r2.png",book_img_pages:{},rotateX:0,rotateY:0,rotateZ:0,pageClick:!0,pageSwipe:!0,pageClickFirst:"close",pageClickLast:"close",bookClick:!0,bookRotateX:!0,bookRotateY:!0,uiButtons:!0,uiPagination:!0,uiPaginationLimit:9,uiPageing:!0,uiPageingDiv:"/"},s,e),this._parseImages(),this.icon_arrow_right='<svg width="72" height="72" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M24.0166 12.0333L47.9834 36L24.0166 59.9667" stroke-miterlimit="10"/>\n</svg>',this.icon_arrow_left='<svg width="72" height="72" viewBox="0 0 72 72" fill="none" xmlns="http://www.w3.org/2000/svg">\n<path d="M47.9834 12.0333L24.0166 36L47.9834 59.9667" stroke-miterlimit="10"/>\n</svg>',this._registerEvents(),this._init()}_registerEvents(){if(this.options.on&&"object"==typeof this.options.on)for(const[t,e]of Object.entries(this.options.on))"function"==typeof e&&this.on(t,e)}on(t,e){this._events[t]||(this._events[t]=[]),this._events[t].push(e)}off(t,e){this._events[t]&&(this._events[t]=this._events[t].filter(t=>t!==e))}emit(t,e={}){this._events[t]&&this._events[t].forEach(t=>t.call(this,e))}init(){this._init()}destroy(){this.resizeObserver.disconnect(),this._applyTo(".vb-book",t=>t.remove()),this._applyTo(".pagination",t=>t.remove()),this._applyTo(".button",t=>t.remove()),this.emit("destroy")}disable(){this._unbindEvents(),this.disabled=!0,this.book.classList.add("disabled"),this.emit("disable")}enable(){this._bindEvents(),this.disabled=!1,this.book.classList.remove("disabled"),this.emit("enable")}pageNum(t){this.bookPageTo(t)}pageNext(){this.bookPage(1)}pagePrev(){this.bookPage(-1)}open(){this.bookOpen()}close(){this.bookClose()}rotateLeft(){this.rotateToAngle(-90)}rotateRight(){this.rotateToAngle(90)}fullscreen(){this.book.requestFullscreen&&(this.book.requestFullscreen(),this.emit("fullscreen"))}play(){this.autoPlay=setInterval(()=>this.nextPage(),2e3),this.emit("play")}stop(){clearInterval(this.autoPlay),this.emit("stop")}_init(){this.emit("initBefore"),this.rotY=this.options.rotateX,this.rotX=this.options.rotateY,this.rotZ=this.options.rotateZ,this.pages=this.options.pages,this.page_current=-1,this.page_count=this.options.pages,this.page_z=0,this.state="closed",this.rotSpeedX=0,this.rotSpeedY=0,this.rotLoop=!1,this._removeClass("","open"),this._removeClass("","opening"),this._removeClass("","prepos"),this._removeClass("","active"),this._removeClass("","disabled"),this._removeClass("","hover"),this.book.innerHTML=`\n            <div class="vb-book">\n              <div class="vb-body">\n                ${this._getCover()}\n                ${this._getBackCover()}\n                ${this._getSpine()}\n                ${this._getBodyFaces()}\n                ${this._getPages()}\n              </div>\n            </div>\n            ${this._getUI()}\n        `,this.vb_body=this.book.querySelector(".vb-book"),this._setStyles(".vb-cover .vb-face","background-color",this.options.coverColor),this._setStyles(".vb-cover.vb-left .vb-face","background-color",this.options.spineColor),this._setStyles(".vb-face.inner","background-color",this.options.pagesColor),this._setStyles(".vb-page > div","background-color",this.options.pagesColor),this._setStyles(".vb-body","transform",`rotateY(${this.options.rotateY}deg) rotateX(${this.options.rotateX}deg) rotateZ(${this.options.rotateZ}deg)`),this.presize(),this.updateUI(),this._bindEvents(),this.resizeObserver=new ResizeObserver(()=>this._resizeHandler()),this.resizeObserver.observe(this.book.parentElement),this.book.tabIndex=0,this.book.addEventListener("focus",()=>this.bookActive()),this.emit("init"),this.emit("initAfter")}_applyTo(t,e){t?this.book.querySelectorAll(t).forEach(e):e(this.book)}_parseDataset(t){const e={};for(const[s,i]of Object.entries(t))if("true"===i)e[s]=!0;else if("false"===i)e[s]=!1;else if(isNaN(i)||""===i.trim())if(i.startsWith("{")&&i.endsWith("}")||i.startsWith("[")&&i.endsWith("]"))try{e[s]=JSON.parse(i)}catch{e[s]=i}else e[s]=i;else e[s]=Number(i);return e}_parseImages(){const t=this.book.querySelector(".cover.front"),e=this.book.querySelector(".cover.back"),s=this.book.querySelector(".cover.spine");this.options.book_img_cover=t?.dataset.src||"",this.options.book_img_back=e?.dataset.src||"",this.options.book_img_spine=s?.dataset.src||"";const i=this.book.querySelector(".edge.head"),o=this.book.querySelector(".edge.tail"),a=this.book.querySelector(".edge.fore");this.options.book_img_pages_top=i?.dataset.src||"",this.options.book_img_pages_bottom=o?.dataset.src||"",this.options.book_img_pages_side=a?.dataset.src||"";const h=this.book.querySelectorAll(".page");this.options.book_img_pages=Array.from(h).map(t=>t.dataset.src||"")}_setStyles=(t,e,s)=>{this._applyTo(t,t=>t.style[e]=s)};_setAttr=(t,e,s)=>{this._applyTo(t,t=>t.setAttribute(e,s))};_addClass(t,e){this._applyTo(t,t=>t.classList.add(e))}_removeClass(t,e){this._applyTo(t,t=>t.classList.remove(e))}presize(){this.w=this.options.width,this.h=this.options.height,this.book_r=this.w/this.h,this.spine_r=this.options.spine/this.h,this.cover_depth_r=this.options.coverThikness/this.h,this.spine_depth_r=this.options.spineThikness/this.h,this.page_offset_r=this.options.pagesOffset/this.h,this._setStyles(".vb-book","aspect-ratio",this.book_r),this.resize()}_resizeHandler(){this._addClass("","resizing"),clearTimeout(this.timer),this.timer=setTimeout(()=>{this._removeClass("","resizing")},200),this.resize()}resize(){this.w=this.vb_body.getBoundingClientRect().width,this.h=this.vb_body.getBoundingClientRect().height;const t=this.h*this.spine_r,e=this.h*this.cover_depth_r,s=this.h*this.spine_depth_r,i=this.h*this.page_offset_r,o=(t,e,s)=>{this.book.querySelectorAll(t).forEach(t=>{t.style[e]=s})};this.book.style.fontSize=t+"px",o(".vb-cover.vb-front","transform",`translateZ(${t/2+e/2}px)`),o(".vb-cover.vb-back","transform",`rotateY(180deg) translateZ(${t/2+e/2}px)`),o(".vb-cover.vb-left","transform",`rotateY(-90deg) translateZ(${this.w/2+s/2-.1}px)`),o(".vb-cover > .vb-front","transform",`translateZ(${e/2}px)`),o(".vb-cover > .vb-back","transform",`translateZ(${-e/2}px)`),o(".vb-cover.vb-left > .vb-front","transform",`translateZ(${s/2}px)`),o(".vb-cover.vb-left > .vb-back","transform",`translateZ(${-s/2}px)`),o(".vb-cover > .vb-left","width",`${e}px`),o(".vb-cover > .vb-left","transform",`rotateY(-90deg) translateZ(${this.w/2}px)`),o(".vb-cover > .vb-right","width",`${e}px`),o(".vb-cover > .vb-right","transform",`rotateY(90deg) translateZ(${this.w/2}px)`),o(".vb-cover > .vb-top","height",`${e}px`),o(".vb-cover > .vb-top","transform",`rotateX(90deg) translateZ(${this.h/2}px)`),o(".vb-cover > .vb-bottom","height",`${e}px`),o(".vb-cover > .vb-bottom","transform",`rotateX(-90deg) translateZ(${this.h/2}px)`),o(".vb-cover.vb-left > .vb-left","width",`${s}px`),o(".vb-cover.vb-left > .vb-left","transform",`rotateY(-90deg) translateZ(${t/2}px)`),o(".vb-cover.vb-left > .vb-right","width",`${s}px`),o(".vb-cover.vb-left > .vb-right","transform",`rotateY(90deg) translateZ(${t/2}px)`),o(".vb-cover.vb-left > .vb-top","height",`${s}px`),o(".vb-cover.vb-left > .vb-bottom","height",`${s}px`),o(".vb-body > .inner.vb-top","width",this.w-i+"px"),o(".vb-body > .inner.vb-top","transform",`rotateX(90deg) rotateZ(0deg) translateZ(${this.h/2-i}px) translateX(${-i/2}px)`),o(".vb-body > .inner.vb-bottom","width",this.w-i+"px"),o(".vb-body > .inner.vb-bottom","transform",`rotateX(-90deg) rotateZ(180deg) translateZ(${this.h/2-i}px) translateX(${i/2}px)`),o(".vb-body > .inner.vb-right","width",this.h-2*i+"px"),o(".vb-body > .inner.vb-right","transform",`rotateY(90deg) rotateZ(90deg) translateZ(${this.w/2-i}px)`),o(".vb-body .vb-page","height",this.h-2*i-1+"px"),o(".vb-body .vb-page > div","width",this.w-i-1+"px"),o(".vb-body .vb-pages","transform","translateZ(0px)"),this.emit("resize")}bookPage(t){if("open"!=this.state)return;let e=this.page_current;return e+=t,console.log("pagedir:"+e),e>this.page_count-1?("close"==this.options.pageClickLast&&this.bookClosePages(),void this.emit("clickPageLast")):e<0?("close"==this.options.pageClickFirst&&this.bookClosePages(),void this.emit("clickPageFirst")):void this.bookPageTo(e)}bookClosePages(){this.closing=!0,this.page_current>0?(console.log("closing:"+this.page_current),this.bookPage(-1)):(this.closing=!1,this.bookClose())}bookPageTo(t){if("open"==this.state){if(t<0&&(t=0),t>this.page_count-1&&(t=this.page_count-1),this.page_current=t,this.emit("pageFlipBefore",{page:t}),this.page_z++,t>0){this.book.querySelectorAll(".vb-body .vb-pages .vb-page")[t-1].style["z-index"]=this.page_z}for(let e=0;e<this.page_count-1;e++){let s=this.book.querySelectorAll(".vb-body .vb-pages .vb-page")[e];e<t?s.classList.add("flip"):s.classList.remove("flip")}1==this.closing&&setTimeout(()=>{this.bookClosePages()},50),this.updateUI(),this.emit("pageFlip",{page:t}),this.emit("pageFlipAfter",{page:t})}}updateUI(){let t=this.page_current;this.book.querySelector(".pagination");const e=Array.from(this.book.querySelectorAll(".pagination .bullet")),s=this.book.querySelector(".pageing .current");if(this.options.uiPaginationLimit){const s=this.options.uiPaginationLimit,i=Math.floor(s/2);let o=t-i,a=t+i;if(o<0&&(a+=Math.abs(o),o=0),a>this.pages-1){const t=a-(this.pages-1);o-=t,a=this.pages-1,o<0&&(o=0)}e.forEach((e,s)=>{e.classList.remove("on","hidden"),s===t&&e.classList.add("on"),(s<o||s>a)&&e.classList.add("hidden")})}else e.forEach((e,s)=>{e.classList.remove("on","hidden"),s===t&&e.classList.add("on")});s.textContent=t+1,this.emit("updateUi",{currentIndex:t})}_getCover(){return`\n\t\t  <div class="vb-face vb-cover vb-front">\n\t\t\t<div class="vb-face vb-back ">\n\t\t\t  ${t(this.options.book_img_cover,"lazyload",50)}\n\t\t\t  <div class="vb-page prehide">\n\t\t\t\t<div class="vb-back ">${t(this.options.book_img_pages[0],"",50)}</div>\n\t\t\t  </div>\n\t\t\t</div>\n\t\t\t<div class="vb-face vb-front">${t(this.options.book_img_cover,"lazyload",50)}</div>\n\t\t\t${this._getDepthFaces(this.options.coverThikness)}\n\t\t  </div>\n\t\t`}_getBackCover(){const e=this.options.book_img_pages[this.options.book_img_pages.length-1];return`\n\t\t  <div class="vb-face vb-cover vb-back">\n\t\t\t<div class="vb-face vb-back ">\n\t\t\t  ${t(this.options.book_img_back,"lazyload",50)}\n\t\t\t  <div class="vb-page prehide">\n\t\t\t\t<div class="vb-back">${t(e,"")}</div>\n\t\t\t  </div>\n\t\t\t</div>\n\t\t\t<div class="vb-face vb-front">${t(this.options.book_img_back,"lazyload",50)}</div>\n\t\t\t${this._getDepthFaces(this.options.coverThikness)}\n\t\t  </div>\n\t\t`}_getSpine(){return`\n      <div class="vb-face vb-cover vb-left">\n        <div class="vb-face vb-front">${t(this.options.book_img_spine,"lazyload",50)}</div>\n        <div class="vb-face vb-back">${t(this.options.book_img_spine,"lazyload",50)}</div>\n        ${this._getDepthFaces(this.options.spineThikness)}\n      </div>\n    `}_getBodyFaces(){return`\n      <div class="vb-face inner vb-right">${t(this.options.book_img_pages_side,"lazyload",50)}</div>\n      <div class="vb-face inner vb-top">${t(this.options.book_img_pages_top,"lazyload",50)}</div>\n      <div class="vb-face inner vb-bottom">${t(this.options.book_img_pages_bottom,"lazyload",50)}</div>\n    `}_getPages(){const e=this.options.pages;let s="";for(let i=0;i<e-1;i++)s+=`\n            <div class="vb-page">\n              <div class="vb-back">${t(this.options.book_img_pages[i+1],"",50)}</div>\n              <div class="vb-front">${t(this.options.book_img_pages[i],"",50)}</div>\n            </div>\n          `;return`<div class="vb-pages prehide">${s}</div>`}_getUI(){const t=this.options.pages;let e="",s="";for(let e=0;e<t;e++)s+='<div class="bullet hidden"></div>';let i=`\n        <button class="button icon left" data="left">${this.icon_arrow_left}</button>\n        <button class="button icon right" data="right">${this.icon_arrow_right}</button>\n      `;return!0===this.options.uiPagination&&(e=`<div class="pagination">${s}</div>`),!0===this.options.uiPageing&&(e+=`<div class="pageing"><span class="current">${this.page_current+1}</span>${this.options.uiPageingDiv}<span class="total">${t}</span></div>`),!0===this.options.uiButtons&&(e+=`${i}`),e}_getDepthFaces(t){return t>0?'\n        <div class="vb-face vb-right"></div>\n        <div class="vb-face vb-left"></div>\n        <div class="vb-face vb-top"></div>\n        <div class="vb-face vb-bottom"></div>\n      ':""}_bindEvents(){this._handlers=this._handlers||{},this.options.uiPagination&&(this._handlers.paginationClick=(t,e)=>{"closed"==this.state&&this.bookOpen(),this.bookPageTo(e)},this._applyTo(".pagination .bullet",(t,e)=>{const s=t=>this._handlers.paginationClick(t,e);t.addEventListener("click",s),this._handlers[`pagination_${e}`]={el:t,handler:s,type:"click"}})),this.options.uiButtons&&(this._handlers.buttonClick=t=>{t.stopPropagation(),t.preventDefault();let e=t.currentTarget.getAttribute("data");"right"==e&&(this.emit("ButtonNextClick"),"open"==this.state?this.bookPage(1):this.rotateToAngle(90)),"left"==e&&(this.emit("ButtonPrevClick"),"open"==this.state?this.bookPage(-1):this.rotateToAngle(-90))},this._applyTo(".button",t=>{t.addEventListener("click",this._handlers.buttonClick),this._handlers[`button_${t.getAttribute("data")}`]={el:t,handler:this._handlers.buttonClick,type:"click"}})),this.tracker=new e(this.vb_body,{threshold:5}),this._handlers.tracker=this.tracker;let t=0,s=0;this.tracker.on("tap",t=>{if(this.emit("click",t),"open"==this.state){if(this.options.pageClick){const e=this.book.getBoundingClientRect();t.x-e.left-e.width/2>0?(this.emit("PageNextClick",t),this.bookPage(1)):(this.emit("PagePrevClick",t),this.bookPage(-1))}}else this.options.bookClick&&this.bookOpen()}),this.tracker.on("swipeLeft",t=>{"open"==this.state&&this.options.pageSwipe&&(this.emit("swipeLeft",t),this.bookPage(1))}),this.tracker.on("swipeRight",t=>{"open"==this.state&&this.options.pageSwipe&&(this.emit("swipeRight",t),this.bookPage(-1))}),this.tracker.on("touchdown",e=>{this.emit("touchStart",e),t=e.x,s=e.y}),this.tracker.on("movestart",t=>{this.isDragging=!0,this._addClass(".vb-body","drag")}),this.tracker.on("touchmove",e=>{if(this.emit("touchMove",e),this._removeClass("","prepos"),this.isDragging){let i=e.x-t,o=e.y-s;t=e.x,s=e.y,this.rotX+=.5*i,this.rotY-=.5*o,this._setStyles(".vb-body","transform",`rotateY(${this.rotX}deg) rotateX(${this.rotY}deg)`)}}),this.tracker.on("moveend",t=>{this.emit("touchEnd"),this.isDragging=!1,this._removeClass(".vb-body","drag")})}_unbindEvents(){this._handlers&&(Object.keys(this._handlers).forEach(t=>{const e=this._handlers[t];e&&e.el&&e.handler&&e.type&&e.el.removeEventListener(e.type,e.handler)}),this._handlers.tracker&&"function"==typeof this._handlers.tracker.destroy&&this._handlers.tracker.destroy(),this._handlers={})}rotateStop(){this.rotLoop=!1}animate(){this.rotX+=this.rotSpeedX,this.rotY+=this.rotSpeedY,this.rotX>=360&&(this.rotX-=360),this.rotY>=360&&(this.rotY-=360),this._setStyles(".vb-body","transform",`rotateY(${this.rotX}deg) rotateX(${this.rotY}deg)`),1==this.rotLoop&&requestAnimationFrame(this.animate.bind(this))}rotateBy(t,e,s=!1){"closed"==this.state&&1!=this.rotLoop&&(this.rotateStop(),this.rotSpeedX=t,this.rotSpeedY=e,this.rotLoop=s,this.animate())}rotateToAngle(t=!1,e=!1){"closed"==this.state&&(this.rotateStop(),!1!==t&&(this.rotX=this._rightAngle(this.rotX)+t),!1!==e&&(this.rotY=this._rightAngle(this.rotY)+e),this._setStyles(".vb-body","transform",`rotateY(${this.rotX}deg) rotateX(${this.rotY}deg)`))}_rightAngle(t){return t%90==0?t:t=90*Math.ceil(t/90)}rotateTo(t=!1,e=!1){"closed"==this.state&&(this.rotateStop(),!1!==t&&(this.rotX=t),!1!==e&&(this.rotY=e),this._setStyles(".vb-body","transform",`rotateY(${this.rotX}deg) rotateX(${this.rotY}deg)`))}bookOpen(){"closed"==this.state&&(this.rotateStop(),this.emit("bookOpenBefore"),this.page_current=0,this.state="open",this._addClass("img","lazyload"),this._removeClass(".vb-page","flip"),this._setStyles(".vb-body","transform",""),this._setAttr("","data-state","open"),this._setAttr("","data-state","open"),this._addClass("","open"),this._addClass("","opening"),this._removeClass("","prepos"),this.updateUI(),setTimeout(()=>{this._removeClass("","opening")},1e3),this.emit("bookOpen"))}bookClose(){"open"==this.state&&(this.emit("bookCloseBefore"),this.page_current=-1,this._removeClass(".vb-page","flip"),this._removeClass("","open"),this._addClass("","closing"),this.updateUI(),this._setStyles(".vb-body","transform","rotateY(0deg) rotateX(0deg) translateX(0%)"),this.rotX=0,this.rotY=0,setTimeout(()=>{this.bookCloseAfter()},1e3),this.emit("bookClose"))}bookCloseAfter(){for(let t=0;t<this.page_count;t++){let e=this.book.querySelectorAll(".vb-body .vb-pages .vb-page")[t];e&&(e.style["z-index"]=this.page_count-t)}this.page_current=-1,this.state="closed",this._setAttr("","data-state","closed"),this._removeClass("","closing"),this.emit("bookCloseAfter")}bookActive(){document.querySelectorAll(".vbook").forEach(t=>{t.classList.remove("active"),t._keyHandler&&(document.removeEventListener("keydown",t._keyHandler),t._keyHandler=null)}),this.book.classList.add("active"),this._keyHandler=t=>{switch(console.log(t.key),t.key){case"Enter":t.preventDefault(),"closed"==this.state?this.bookOpen():this.bookClose();break;case" ":t.preventDefault(),"open"==this.state?this.bookClose():this.bookOpen();break;case"ArrowRight":t.preventDefault(),"open"==this.state?this.bookPage(1):this.rotateToAngle(90);break;case"ArrowLeft":t.preventDefault(),"open"==this.state?this.bookPage(-1):this.rotateToAngle(-90)}},document.addEventListener("keydown",this._keyHandler),this.emit("active")}}});